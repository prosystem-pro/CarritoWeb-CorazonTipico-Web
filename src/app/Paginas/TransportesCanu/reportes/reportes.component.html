<app-nabar-sidebar></app-nabar-sidebar>

<div class="container-fluid mt-4" *ngIf="reporte">

    <div class="card shadow-lg w-100 rounded-5">

        <!-- HEADER -->
        <div class="card-header text-white py-3" style="background-color: #000000; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.25);">

            <div class="row align-items-center">
                <!-- Columna icono -->
                <div class="col-auto">
                    <i class="bi bi-file-bar-graph fs-3 fs-sm-4 text-white"></i>
                </div>

                <!-- Columna título -->
                <div class="col text-center">
                    <h5 class="mb-0 fw-semibold fs-5 fs-sm-6"
                        style="word-break: break-word; overflow-wrap: break-word;">
                        Reportes
                    </h5>
                </div>

                <!-- Columna botón cerrar -->
                <div class="col-auto">
                    <button type="button" class="btn p-2"
                        style="background-color:white; border-radius:8px; border:2px solid black;"
                        (click)="RegresarInicio()">
                        <div class="rounded-circle d-flex align-items-center justify-content-center"
                            style="width:28px; height:28px; background-color:white;">
                            ✕
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- BODY -->
        <div class="card-body px-3 py-4">

            <!-- FILTROS AÑO / MES -->
            <div class="row mb-3 justify-content-start">
                <div class="col-12 col-md d-flex gap-2 justify-content-start flex-wrap">

                    <select class="form-select form-select-sm" [(ngModel)]="filtroAnio" (change)="Filtrar()"
                        style="max-width: 140px;">
                        <option value="">Año</option>
                        <option *ngFor="let a of anios" [value]="a">{{ a }}</option>
                    </select>

                    <select class="form-select form-select-sm" [(ngModel)]="filtroMes" (change)="Filtrar()"
                        style="max-width: 140px;">
                        <option value="">Mes</option>
                        <option *ngFor="let m of meses" [value]="m.value">{{ m.name }}</option>
                    </select>

                </div>
            </div>

            <!-- TITULO DEL MES -->
            <div class="row mb-4" *ngIf="nombreMesSeleccionado">
                <div class="col-12">
                    <div class="text-center text-white py-2" style="background-color: #000000; border-radius: 8px;">
                        <strong>{{ nombreMesSeleccionado }}</strong>
                    </div>
                </div>
            </div>

            <!-- TOTAL VIAJES -->
            <div class="row mb-4 justify-content-center">
                <div class="col-10 col-md-4">
                    <div class="card shadow-sm rounded-4 overflow-hidden d-flex flex-column responsive-card">

                        <!-- TEXTO -->
                        <div class="card-body text-center" style="height: 50%;">
                            <h3 class="fw-bold mb-1">
                                Q {{ reporte.TotalViajes | number:'1.2-2' }}
                            </h3>
                            <p class="text-muted mb-0">Total de viajes</p>
                        </div>

                        <!-- GRAFICA ANIMADA -->
                        <div class="animated-chart chart-blue">
                            <span></span><span></span><span></span><span></span><span></span>
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>

                    </div>
                </div>
            </div>

            <!-- REPORTES INTERMEDIOS -->
            <div class="row g-3 mb-4 justify-content-center">
                <div class="col-6 col-md-4" *ngFor="let item of [
                  {v: reporte.Chofer, t:'Pago Chofer', c:'chart-red'},
                  {v: reporte.Combustible, t:'Combustible', c:'chart-red'},
                  {v: reporte.ImprevistosViajes, t:'Imprevistos Viajes', c:'chart-red'},
                  {v: reporte.Mecanico, t:'Mecánico', c:'chart-red'},
                  {v: reporte.Repuestos, t:'Repuestos', c:'chart-red'},
                  {v: reporte.ImprevistosMantenimiento, t:'Imprevistos Mantenimiento', c:'chart-red'}
                ]">

                    <div class="card shadow-sm rounded-4 overflow-hidden d-flex flex-column responsive-card">

                        <div class="card-body text-center" style="height: 50%;">
                            <h5 class="fw-bold">
                                Q {{ item.v | number:'1.2-2' }}
                            </h5>
                            <p class="text-muted mb-0">{{ item.t }}</p>
                        </div>

                        <div [class]="'animated-chart ' + item.c">
                            <span></span><span></span><span></span><span></span><span></span>
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>

                    </div>
                </div>
            </div>

            <!-- GANANCIAS -->
            <div class="row justify-content-center">
                <div class="col-10 col-md-4">
                    <div class="card shadow-sm rounded-4 overflow-hidden d-flex flex-column responsive-card">

                        <div class="card-body text-center" style="height: 50%;">
                            <h3 class="fw-bold text-black mb-1">
                                Q {{ reporte.Ganancias | number:'1.2-2' }}
                            </h3>
                            <p class="text-muted mb-0">Ganancias</p>
                        </div>

                        <div class="animated-chart chart-green">
                            <span></span><span></span><span></span><span></span><span></span>
                            <span></span><span></span><span></span><span></span><span></span>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- CARGANDO -->
<div class="text-center mt-5" *ngIf="!reporte">
    <span class="text-muted">Cargando reporte...</span>
</div>